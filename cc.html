<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>‚ö†Ô∏è WebView Security Demonstration</title>
  <style>
    body { 
      background: #f5f5f5; 
      color: #333; 
      font-family: 'Consolas', monospace; 
      padding: 1rem; 
      max-width: 800px;
      margin: 0 auto;
    }
    .disclaimer {
      background-color: #fff8e1;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin-bottom: 20px;
    }
    iframe { 
      width: 100%; 
      height: 300px; 
      border: 1px solid #ddd; 
      margin-top: 1rem; 
      background: white;
    }
    button { 
      padding: 0.5rem 1rem; 
      background: #4CAF50; 
      border: none; 
      color: white; 
      font-weight: bold; 
      cursor: pointer; 
      border-radius: 4px;
    }
    #log { 
      margin-top: 1rem; 
      background: white;
      padding: 1rem;
      border: 1px solid #ddd;
      font-size: 0.9rem; 
      white-space: pre-wrap; 
    }
  </style>
</head>
<body>

<div class="disclaimer">
  <h3>‚ö†Ô∏è Security Research Demonstration</h3>
  <p>This is a <strong>safe simulation</strong> for educational purposes only. Never test security vulnerabilities without explicit permission.</p>
</div>

<h2>üîç WebView postMessage Handling Demo</h2>
<p>Click the button to send a test message to the simulated WebView:</p>
<button onclick="sendDemoMessage()">üì§ Send Test Message</button>

<iframe id="webview" srcdoc='
  <!DOCTYPE html>
  <html>
  <head>
    <style>
      body { font-family: Arial; padding: 1rem; }
      #output { 
        padding: 1rem;
        margin-top: 1rem;
        background: #f9f9f9;
        border: 1px dashed #ccc;
      }
    </style>
  </head>
  <body>
    <h3>WebView Simulation</h3>
    <div id="output">[waiting for message...]</div>
    <script>
      window.addEventListener("message", (e) => {
        const output = document.getElementById("output");
        console.log("Message received:", e.data);
        
        // Secure alternative: Use textContent instead of innerHTML
        if (e.data?.demoContent) {
          output.textContent = "Received: " + e.data.demoContent;
        } else {
          output.textContent = "[Invalid message format]";
        }
      });
    </script>
  </body>
  </html>
'></iframe>

<div id="log">[Event log will appear here]</div>

<script>
function sendDemoMessage() {
  const payload = {
    demoContent: "This is a safe text demonstration (in a real vulnerability, this might be processed as HTML)"
  };
  
  const iframe = document.getElementById("webview");
  try {
    iframe.contentWindow.postMessage(payload, "*");
    document.getElementById("log").textContent = 
      "üì§ Message sent:\n" + 
      JSON.stringify(payload, null, 2) +
      "\n\nNote: This demonstrates how messages are received. In vulnerable systems, improper handling could lead to security issues.";
  } catch (e) {
    document.getElementById("log").textContent = "Error: " + e.message;
  }
}
</script>

</body>
</html>
