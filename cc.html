<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>🔥 WebView XSS Demonstration</title>
  <style>
    body { 
      background: #f5f5f5; 
      color: #333; 
      font-family: 'Consolas', monospace; 
      padding: 1rem; 
      max-width: 800px;
      margin: 0 auto;
    }
    .disclaimer {
      background-color: #fff8e1;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin-bottom: 20px;
    }
    iframe { 
      width: 100%; 
      height: 300px; 
      border: 1px solid #ddd; 
      margin-top: 1rem; 
      background: white;
    }
    button { 
      padding: 0.5rem 1rem; 
      background: #e53935; 
      border: none; 
      color: white; 
      font-weight: bold; 
      cursor: pointer; 
      border-radius: 4px;
    }
    #log { 
      margin-top: 1rem; 
      background: white;
      padding: 1rem;
      border: 1px solid #ddd;
      font-size: 0.9rem; 
      white-space: pre-wrap; 
    }
  </style>
</head>
<body>

<div class="disclaimer">
  <h3>⚠️ Security Research Demonstration</h3>
  <p>This is a <strong>vulnerable simulation</strong> for educational purposes. It shows what happens when user input is injected into the DOM without sanitization.</p>
</div>

<h2>🔥 WebView postMessage XSS Demo</h2>
<p>Click the button to send an <strong>XSS payload</strong> to the simulated WebView:</p>
<button onclick="sendXSS()">💥 Send XSS Payload</button>

<iframe id="webview" srcdoc='
  <!DOCTYPE html>
  <html>
  <head>
    <style>
      body { font-family: Arial; padding: 1rem; }
      #output { 
        padding: 1rem;
        margin-top: 1rem;
        background: #fff3e0;
        border: 1px dashed #f57c00;
      }
    </style>
  </head>
  <body>
    <h3>🧪 Vulnerable WebView Simulation</h3>
    <div id="output">[waiting for message...]</div>
    <script>
      window.addEventListener("message", (e) => {
        const output = document.getElementById("output");
        console.log("📩 Message received:", e.data);

        // ❌ خطير: إدخال البيانات في DOM مباشرة بدون تعقيم
        if (e.data?.dangerousHTML) {
          output.innerHTML = e.data.dangerousHTML;
        } else {
          output.textContent = "[Invalid message format]";
        }
      });
    </script>
  </body>
  </html>
'></iframe>

<div id="log">[Event log will appear here]</div>

<script>
function sendXSS() {
  const payload = {
    dangerousHTML: `<script>alert('🔥 XSS confirmed')</script>`
  };

  const iframe = document.getElementById("webview");
  try {
    iframe.contentWindow.postMessage(payload, "*");
    document.getElementById("log").textContent = 
      "📤 XSS Payload sent:\n" + 
      JSON.stringify(payload, null, 2);
  } catch (e) {
    document.getElementById("log").textContent = "Error: " + e.message;
  }
}
</script>

</body>
</html>
